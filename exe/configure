#!/bin/sh
. .lib.configure
if [ "$DIR" = '.' ]; then
	err This script is not intended to be executed directly
	exit 1
fi

EXECUTABLES=
for file in "${DIR}"/*.c; do
	export EXECUTABLES="$(basename "${file%.c}") ${EXECUTABLES}"
done
EXECUTABLES="${EXECUTABLES## }"

DEBUG_EXECUTABLES=
for executable in $EXECUTABLES; do
	export DEBUG_EXECUTABLES="${executable}_debug ${DEBUG_EXECUTABLES}"
done
DEBUG_EXECUTABLES="${DEBUG_EXECUTABLES## }"

sed -e "s|@@EXECUTABLES@@|$EXECUTABLES|g" \
	-e "s|@@DEBUG_EXECUTABLES@@|$DEBUG_EXECUTABLES|g" \
	-e "s|@@EXE_MAKEFILE@@|${DIR}/makefile.in|g" \
	"${DIR}/makefile.in"

for file in "${DIR}"/*.c; do
	printf '%s =' "$(basename "${file%.c}")_src"
	printf ' %s' "${file%.c}.o"
	for header in $(recurse_headers "$file"); do
		if echo "$header" | grep -q '^mod/'; then
			printf ' %s' "${header%.h}.o"
		fi
	done
	echo
	printf '%s:' "$(basename "${file%.c}")"
	printf ' %s' "${file%.c}.o"
	for header in $(recurse_headers "$file"); do
		if echo "$header" | grep -q '^mod/'; then
			printf ' %s' "${header%.h}.o"
		fi
	done
	echo
done

# vim: nowrap
