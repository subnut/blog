#!/bin/sh
. .lib.configure

if [ "$DIR" = '.' ]; then
	err This script is not intended to be executed directly
	exit 1
fi

EXECUTABLES=
DEBUG_EXECUTABLES=
for file in "${DIR}"/*.c; do
	export EXECUTABLES="${EXECUTABLES} $(basename "${file%.c}")"
	export DEBUG_EXECUTABLES="${DEBUG_EXECUTABLES} debug_$(basename "${file%.c}")"
done
EXECUTABLES="${EXECUTABLES## }"
DEBUG_EXECUTABLES="${DEBUG_EXECUTABLES## }"

sed -e "s|@@EXECUTABLES@@|$EXECUTABLES|g" \
	-e "s|@@DEBUG_EXECUTABLES@@|$DEBUG_EXECUTABLES|g" \
	"${DIR}"/Makefile.in

for file in "${DIR}"/*.c; do
	printf '%s =' "$(basename "${file%.c}")_src"
	printf ' %s' "${file%.c}.o"
	for header in $(recurse_headers "$file"); do
		if echo "$header" | grep -q '^mod/'; then
			printf ' %s' "${header%.h}.o"
		fi
	done
	echo
	printf '%s:' "$(basename "${file%.c}")"
	printf ' %s' "${file%.c}.o"
	for header in $(recurse_headers "$file"); do
		if echo "$header" | grep -q '^mod/'; then
			printf ' %s' "${header%.h}.o"
		fi
	done
	echo
done

# vim: nowrap
